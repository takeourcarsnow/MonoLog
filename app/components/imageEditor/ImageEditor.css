/* ImageEditor styles */

.image-editor {
  display: flex;
  flex-direction: column;
  /* allow the editor to size to content while using flex to fill available
    vertical space when in fullscreen; avoid forcing an overly large min-height
    that creates empty space below controls. */
  height: auto;
  min-height: 0; /* important for flex children to not overflow their parent */
  max-height: calc(var(--viewport-height, 1vh) * 100);
  overflow: hidden;
  /* other styles */
  width: 100%;
  max-width: min(92vw, 820px);
  margin: 0 auto;
  color: var(--text);
  padding: 8px;
  padding-bottom: 6px; /* slightly reduced bottom padding to reclaim space */
  border-radius: 8px;
  /* subtle mount animation: only translate and fade (no scaling) to
    avoid a size jump when the canvas finishes sizing. */
  transform: translateY(0);
  opacity: 1;
  transition: opacity 220ms ease, transform 260ms cubic-bezier(.2,.9,.2,1);
}

.image-editor.unmounted {
  transform: translateY(6px);
  opacity: 0;
}

/* Full-screen mode for upload editor: fill from top to bottom but centered horizontally */
.upload-editor-fullscreen .image-editor {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: auto;
  max-width: min(85vw, 720px);
  /* use full available height but allow internal flex children to size properly */
  height: auto;
  max-height: 95vh;
  margin: 0;
  padding: 8px;
  padding-bottom: 6px; /* reduce bottom padding in fullscreen */
  border-radius: 8px;
  /* sit above the portal overlay so the editor itself can receive clicks */
  z-index: 10001;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: stretch; /* ensure children stretch vertically to fill space */
}

/* When Portal creates an element with class `upload-editor-fullscreen`, we want
   that root to cover the viewport and absorb clicks so elements underneath
   (like the bottom tabbar) cannot be clicked. The portal root is usually
   created with id `modal-root` by `Portal.tsx` and may carry the class
   `upload-editor-fullscreen` when used for the editor. */
#modal-root.upload-editor-fullscreen {
  position: fixed !important;
  inset: 0; /* top:0; right:0; bottom:0; left:0 */
  width: 100vw;
  height: 100vh;
  display: flex;
  /* center the editor vertically and horizontally */
  align-items: center;
  justify-content: center;
  /* small top padding so the editor sits slightly below any safe-area */
  padding: 12px;
  overflow-y: auto; /* allow scrolling if editor height exceeds viewport */
  z-index: 10000; /* higher than .tabbar (9999) */
  pointer-events: auto;
}

/* Transparent overlay layer that covers the full viewport and sits behind the editor
   box but above the rest of the app. It absorbs clicks and can be used to close the
   editor if desired (not hooked here). */
#modal-root.upload-editor-fullscreen::before {
  content: '';
  position: absolute;
  inset: 0;
  background: transparent;
  /* Ensure this overlay sits under the editor box but above the app */
  z-index: 10000;
  pointer-events: auto; /* capture clicks */
}

.image-editor-canvas-container {
  flex: 1 1 auto;
  min-height: 0; /* avoid flex item causing parent to overflow */
  overflow: hidden;
}

.image-editor-panels-container {
  flex: 0 0 auto;
  max-height: 160px;
  overflow-y: auto;
  padding-bottom: 6px; /* small padding so content isn't flush, but not too tall */
}

/* Responsive adjustments for full-screen mode */
@media (max-width: 640px) {
  .upload-editor-fullscreen .image-editor {
    max-width: 95vw;
    height: 95vh;
    padding: 8px;
  }
  
  .upload-editor-fullscreen .imgedit-panels {
  max-height: calc(95vh - 120px);
  }
  
  .upload-editor-fullscreen .image-editor-buttons .btn.icon {
    padding: 4px;
    width: 28px;
    height: 28px;
  }
}

/* Ensure panels are visible in full-screen mode */
.upload-editor-fullscreen .imgedit-panels {
  height: auto;
  overflow-y: auto;
  overflow-x: hidden;
}

.upload-editor-fullscreen .imgedit-panels > div {
  position: relative;
  height: auto;
}

/* Category button hover effects */
.cat-btn .cat-label {
  max-width: 0;
  opacity: 0;
  transition: max-width 200ms ease, opacity 180ms ease, margin 180ms ease;
  margin-left: 0;
}
.cat-btn[data-active="true"] .cat-label {
  max-width: 80px;
  opacity: 1;
  margin-left: 8px;
}

.imgedit-range {
  -webkit-appearance: none;
  appearance: none;
  height: 10px;
  border-radius: 999px;
  outline: none;
  transition: box-shadow .2s ease, transform .2s ease;
  cursor: pointer;
  max-width: 100%;
  box-sizing: border-box;
  /* allow horizontal dragging on the slider itself and prevent parent swipers
     from intercepting those horizontal gestures */
  touch-action: pan-x;
}
.imgedit-range:hover { transform: scaleY(1.1); }
.imgedit-range:active { box-shadow: 0 8px 24px rgba(0,0,0,0.16); }

.imgedit-range::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: white;
  border: 3px solid var(--primary);
  box-shadow: 0 4px 14px rgba(0,0,0,0.2), 0 2px 6px rgba(0,0,0,0.1);
  transition: transform .15s cubic-bezier(.2,.9,.2,1), box-shadow .15s ease;
  cursor: grab;
}
.imgedit-range::-webkit-slider-thumb:hover {
  transform: scale(1.15);
  box-shadow: 0 6px 20px rgba(0,0,0,0.25);
}
.imgedit-range::-webkit-slider-thumb:active {
  transform: scale(1.05);
  cursor: grabbing;
}

.imgedit-range::-moz-range-thumb {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: white;
  border: 3px solid var(--primary);
  box-shadow: 0 4px 14px rgba(0,0,0,0.2);
  cursor: grab;
}
.imgedit-range::-moz-range-thumb:hover { transform: scale(1.15); }
.imgedit-range::-moz-range-thumb:active { transform: scale(1.05); cursor: grabbing; }

/* custom focus ring */
.imgedit-range:focus { box-shadow: 0 0 0 4px color-mix(in srgb, var(--primary) 15%, transparent); }
.imgedit-range:focus::-webkit-slider-thumb { box-shadow: 0 0 0 6px color-mix(in srgb, var(--primary) 25%, transparent), 0 4px 14px rgba(0,0,0,0.2); }

/* Hide horizontal scrollbar for category selector but keep scrollable (touch/drag) */
.categories-scroll {
  overflow-x: auto;
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */
}
.categories-scroll::-webkit-scrollbar { height: 0; display: none; }

/* panels responsiveness: allow panels to grow and scroll on small viewports */
.imgedit-panels {
  position: relative;
  overflow-y: auto;
  overflow-x: hidden; /* prevent horizontal scroll */
  border-radius: 12px;
  background: color-mix(in srgb, var(--bg-elev) 95%, var(--primary) 5%);
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.06);
}
.imgedit-panels > div { height: auto; }

.imgedit-panel-inner {
  box-sizing: border-box;
  overflow-y: auto;
  overflow-x: hidden; /* avoid transient horizontal scroll */
  -webkit-overflow-scrolling: touch;
  padding: 10px; /* slightly reduced padding */
  gap: 10px;
  display: grid;
  background: var(--bg-color);
  border-radius: 8px;
  min-height: 100px; /* lower min-height to prevent panels from forcing tall layout */
}

/* Reduce header icon button size to make the top bar less tall */
.image-editor-buttons .btn.icon {
  padding: 2px; /* smaller hit area while keeping icons tappable */
  width: 24px;
  height: 24px;
  border-radius: 10px;
  font-size: 13px;
}

@media (min-width: 720px) { .imgedit-panels { max-height: 160px; } }
@media (max-width: 720px) { .imgedit-panels { max-height: 160px; } }

/* slider color variables (theme-aware) */
.image-editor {
  /* defaults; app theme can override these CSS variables */
  --slider-exposure-start: #fff6db;
  --slider-exposure-end: #ffd166;
  --slider-contrast-start: #fff3e6;
  --slider-contrast-end: #ff9f43;
  --slider-saturation-start: #ffe9e9;
  --slider-saturation-end: #ff6b6b;
  --slider-temperature-cold: #66d1ff;
  --slider-temperature-warm: #ffb86b;
  /* unified heat gradient used across primary sliders */
  --slider-heat-start: #2d9cff;
  --slider-heat-end: #ffd166;
  /* rotation slider colors: left is subtle blue, right is warm so the track forms a blue->warm heat gradient */
  --slider-rotation-start: var(--slider-heat-start);
  --slider-rotation-end: var(--slider-heat-end);
}

/* Prefer a slightly lighter/whiter right-side color in dark mode so the filled portion remains visible */
@media (prefers-color-scheme: dark) {
  .image-editor {
    --slider-rotation-end: #ffdc99;
  }
}

/* visually-hidden helper for screen readers */
.sr-only { position: absolute !important; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }