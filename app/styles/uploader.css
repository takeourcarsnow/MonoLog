/* Strong page-level override when uploader has an active preview (JS toggles
  `body.uploader-has-preview`). This lives immediately after the base
  `.content` so it reliably overrides earlier padding. Adjust to taste. */
body.uploader-has-preview .content {
  padding-bottom: calc(28px + var(--safe-bottom)) !important;
}

/* Debug outline: add `document.body.classList.add('debug-uploader-outline')`
  in browser console to reveal outlines for the main containers while
  debugging the remaining vertical gap. Remove the class when done. */
body.debug-uploader-outline .content { outline: 3px dashed rgba(255,0,0,0.95); }
body.debug-uploader-outline .uploader { outline: 3px dashed rgba(0,200,0,0.95); }
body.debug-uploader-outline .tabbar { outline: 3px dashed rgba(0,0,255,0.95); }

/* Uploader-specific carousel/thumbnail layout to avoid interfering with post card styles */
.uploader .preview-inner { display: flex; flex-direction: column; align-items: center; gap: 8px; }
.uploader .preview-inner .carousel { width: 100%; display: flex; gap: 8px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
.uploader .preview-inner .carousel.carousel-track { overflow-x: visible; }
.uploader .preview-inner .carousel > div { flex: 0 0 100%; scroll-snap-align: center; position: relative; }
.uploader .preview-inner .carousel-track { width: auto; }
.uploader .thumbs { display: flex; gap: 8px; margin-top: 8px; justify-content: center; align-items: center; }
.uploader .thumbs button { padding: 0; border-radius: 8px; overflow: hidden; border: 1px solid var(--border); }
.uploader .thumbs img { width: 72px; height: 72px; object-fit: cover; display: block; }

.uploader { display: grid; gap: 12px; }
/* Subtle Minimalistic Drop Zone Styles */
.drop-zone {
  position: relative;
  display: grid;
  place-items: center;
  min-height: 220px;
  padding: 40px 32px;
  border: 1px dashed color-mix(in srgb, var(--border), transparent 60%);
  border-radius: 16px;
  background: transparent;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  animation: gentle-float 6s ease-in-out infinite;
}

.drop-zone:hover {
  border-color: color-mix(in srgb, var(--primary), transparent 40%);
  background: color-mix(in srgb, var(--primary-weak), transparent 95%);
  transform: translateY(-1px);
}

.drop-zone.dragover {
  border-color: var(--primary);
  background: color-mix(in srgb, var(--primary-weak), transparent 90%);
  transform: translateY(-2px);
  animation: subtle-pulse 2s ease-in-out infinite;
}

.drop-zone:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--primary), transparent 60%);
  outline-offset: 2px;
}

.drop-zone-loader {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 20px;
  background: color-mix(in srgb, var(--bg), rgba(255,255,255,0.8));
  backdrop-filter: blur(4px) saturate(110%);
  animation: fade-in 0.4s ease both;
  z-index: 10;
  border-radius: 16px;
  color: var(--text);
}

.drop-zone-loader::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: color-mix(in srgb, var(--bg), rgba(255,255,255,0.6));
  backdrop-filter: blur(4px) saturate(110%);
  -webkit-backdrop-filter: blur(4px) saturate(110%);
  opacity: 0;
  transition: opacity 0.4s ease;
  z-index: -1;
}

.drop-zone-loader.show-blur::before { opacity: 1; }

.drop-zone-content {
  display: grid;
  place-items: center;
  gap: 20px;
  text-align: center;
  transition: opacity 0.4s ease;
}

.drop-zone-icon {
  width: 72px;
  height: 72px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  background: color-mix(in srgb, var(--primary-weak), transparent 85%);
  border: 1px solid color-mix(in srgb, var(--primary), transparent 90%);
  color: var(--primary);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  animation: gentle-breathe 4s ease-in-out infinite;
}

.drop-zone:hover .drop-zone-icon {
  transform: scale(1.05);
  background: color-mix(in srgb, var(--primary-weak), transparent 75%);
  border-color: color-mix(in srgb, var(--primary), transparent 80%);
}

.drop-zone.dragover .drop-zone-icon {
  transform: scale(1.08);
  background: color-mix(in srgb, var(--primary-weak), transparent 70%);
  border-color: var(--primary);
  color: var(--primary);
}

.drop-zone-text {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.drop-zone-title {
  font-size: 16px;
  font-weight: 500;
  color: var(--text);
  margin: 0;
  letter-spacing: -0.01em;
}

.drop-zone-subtitle {
  font-size: 13px;
  font-weight: 400;
  color: var(--muted);
  margin: 0;
}

.drop-zone-meta {
  display: flex;
  flex-direction: column;
  gap: 6px;
  align-items: center;
}

.file-limits {
  font-size: 11px;
  font-weight: 400;
  color: var(--muted);
  background: color-mix(in srgb, var(--bg-elev), transparent 60%);
  padding: 4px 10px;
  border-radius: 8px;
  border: 1px solid color-mix(in srgb, var(--border), transparent 80%);
}

.drop-zone-actions {
  margin-top: 12px;
}

.camera-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border-radius: 12px;
  background: transparent;
  border: 1px solid color-mix(in srgb, var(--border), transparent 60%);
  color: var(--muted);
  font-weight: 500;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.camera-btn:hover {
  background: color-mix(in srgb, var(--bg-elev), transparent 50%);
  border-color: color-mix(in srgb, var(--primary), transparent 70%);
  color: var(--text);
  transform: translateY(-1px);
}

.camera-btn:active {
  transform: translateY(0);
}

.camera-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.camera-btn-text {
  font-weight: 500;
}

.processing-text {
  font-size: 14px;
  font-weight: 500;
  color: var(--text);
}

/* Organic Animations */
@keyframes gentle-float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-2px); }
}

@keyframes gentle-breathe {
  0%, 100% {
    transform: scale(1);
    opacity: 0.9;
  }
  50% {
    transform: scale(1.02);
    opacity: 1;
  }
}

@keyframes subtle-pulse {
  0%, 100% {
    border-color: var(--primary);
    background: color-mix(in srgb, var(--primary-weak), transparent 90%);
  }
  50% {
    border-color: color-mix(in srgb, var(--primary), transparent 20%);
    background: color-mix(in srgb, var(--primary-weak), transparent 95%);
  }
}

@keyframes fade-in {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Light theme adjustments */
:root[data-theme="light"] .drop-zone {
  background: rgba(255, 255, 255, 0.4);
}

:root[data-theme="light"] .drop-zone:hover {
  background: rgba(255, 255, 255, 0.6);
}

:root[data-theme="light"] .drop-zone.dragover {
  background: rgba(255, 255, 255, 0.7);
}

:root[data-theme="light"] .drop-zone-loader {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
}

:root[data-theme="light"] .drop-zone-loader::before {
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  opacity: 1;
}

:root[data-theme="light"] .camera-btn {
  background: rgba(255, 255, 255, 0.6);
  border-color: rgba(0, 0, 0, 0.1);
}

:root[data-theme="light"] .camera-btn:hover {
  background: rgba(255, 255, 255, 0.8);
  border-color: rgba(0, 0, 0, 0.15);
}

/* Mobile optimizations */
@media (max-width: 640px) {
  .drop-zone {
    min-height: 180px;
    padding: 32px 24px;
  }

  .drop-zone-icon {
    width: 60px;
    height: 60px;
  }

  .drop-zone-icon svg {
    width: 28px;
    height: 28px;
  }

  .drop-zone-title {
    font-size: 15px;
  }

  .drop-zone-subtitle {
    font-size: 12px;
  }

  .file-limits {
    font-size: 10px;
    padding: 3px 8px;
  }

  .camera-btn {
    padding: 7px 14px;
    font-size: 12px;
  }

  .camera-btn svg {
    width: 16px;
    height: 16px;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .drop-zone,
  .drop-zone-icon,
  .camera-btn,
  .drop-zone-loader {
    transition: none !important;
    animation: none !important;
  }

  .drop-zone:hover,
  .drop-zone.dragover,
  .drop-zone:hover .drop-zone-icon,
  .drop-zone.dragover .drop-zone-icon,
  .camera-btn:hover,
  .camera-btn:active {
    transform: none !important;
  }
}

/* LogoLoader Animations */
.logo-rotate-slow {
  animation: logo-rotate-slow 8s linear infinite;
}

.logo-rotate-fast {
  animation: logo-rotate-fast 2s linear infinite;
}

.logo-sparks .spark:nth-child(1) {
  animation: logo-spark-1 3s ease-in-out infinite;
}

.logo-sparks .spark:nth-child(2) {
  animation: logo-spark-2 3s ease-in-out infinite 0.5s;
}

.logo-sparks .spark:nth-child(3) {
  animation: logo-spark-3 3s ease-in-out infinite 1s;
}

.logo-sparks .spark:nth-child(4) {
  animation: logo-spark-4 3s ease-in-out infinite 1.5s;
}

.logo-ring-arc {
  animation: logo-ring-arc 4s ease-in-out infinite;
}

.logo-dot {
  animation: logo-dot-pulse 2s ease-in-out infinite;
}

@keyframes logo-rotate-slow {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes logo-rotate-fast {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes logo-spark-1 {
  0%, 100% { opacity: 0; transform: scale(0.8) translateY(0); }
  50% { opacity: 1; transform: scale(1.2) translateY(-4px); }
}

@keyframes logo-spark-2 {
  0%, 100% { opacity: 0; transform: scale(0.8) translateY(0); }
  50% { opacity: 1; transform: scale(1.2) translateY(-4px); }
}

@keyframes logo-spark-3 {
  0%, 100% { opacity: 0; transform: scale(0.8) translateY(0); }
  50% { opacity: 1; transform: scale(1.2) translateY(-4px); }
}

@keyframes logo-spark-4 {
  0%, 100% { opacity: 0; transform: scale(0.8) translateY(0); }
  50% { opacity: 1; transform: scale(1.2) translateY(-4px); }
}

@keyframes logo-ring-arc {
  0% { stroke-dashoffset: 88; }
  50% { stroke-dashoffset: 44; }
  100% { stroke-dashoffset: 88; }
}

@keyframes logo-dot-pulse {
  0%, 100% { r: 18; opacity: 0.8; }
  50% { r: 22; opacity: 1; }
}

/* Reduced motion support for LogoLoader */
@media (prefers-reduced-motion: reduce) {
  .logo-rotate-slow,
  .logo-rotate-fast,
  .logo-sparks .spark,
  .logo-ring-arc,
  .logo-dot {
    animation: none !important;
  }
}

/* Desktop uploader tweaks: keep preview from growing so large it pushes
  the publish/cancel controls offscreen at default browser zoom. Reserve
  extra bottom padding when a preview exists and cap preview heights
  relative to the viewport so buttons remain visible. */
@media (min-width: 900px) {
  /* Reserve more space at the bottom of the page when the uploader has a preview
    so the tabbar and publish controls do not overlap the form at default zoom. */
  /* Make more room at the bottom for the tabbar + action row so the publish
    controls are unlikely to be occluded on desktop. */
  /* Reserve space equal to the fixed action bar height so page content
    (caption input, etc.) doesn't get overlapped. The action bar is fixed
    to the bottom and visually sits above the tabbar; keep container
    padding in sync with the action bar height. */
  .uploader.has-preview { padding-bottom: calc(92px + var(--safe-bottom)) !important; }

  /* Aggressively cap preview height on desktop so the form controls remain
    visible without requiring the user to scroll. */
  /* Cap preview heights so the form controls remain visible without forcing
    excessive empty space below the preview on desktop. Reduced chrome offset
    prevents unnecessarily large gaps that create a vertical scrollbar. */
  .uploader .preview-inner { max-height: min(40vh, calc(100dvh - 180px)); }
  .uploader .preview img { max-height: min(40vh, calc(100dvh - 180px)); }

  /* On wide screens, keep the normal layout spacing, but when a preview
     exists show the uploader action row as a fixed, centered bar above
     the bottom nav. This prevents reserving large blank space while
     keeping controls accessible. */
  .uploader .form-row { margin-top: 2px; }

  .uploader.has-preview .form-row {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: calc(12px + var(--safe-bottom));
    z-index: 100002;
    width: min(calc(100% - 48px), var(--maxw));
    height: 72px; /* reserve a consistent action bar height */
    display: flex;
    align-items: center; /* vertically center the buttons */
    justify-content: space-between;
   gap: 12px;
   /* Keep layout/spacing but remove the visible rounded container so
     buttons don't sit inside a separate box. */
   background: transparent;
   border-radius: 0;
   padding: 0 6px; /* keep a little horizontal breathing room */
   pointer-events: auto;
   box-shadow: none;
   z-index: 120000;
  }
}

/* Spacer to prevent the fixed action bar from overlapping page content.
   Adds an invisible block at the end of the uploader equal to the action
   bar height + safe area so inputs are always visible above the fixed bar. */
@media (min-width: 900px) {
  .uploader.has-preview::after {
    content: "";
    display: block;
    height: calc(32px + var(--safe-bottom));
    width: 100%;
    pointer-events: none;
  }
}

/* Reduce the vertical gap between the caption input and action pills specifically
   inside the uploader to make the controls feel more compact on desktop and mobile */
.uploader .form-row { margin-top: 2px; gap: 6px; }

/* Additional, page-scoped desktop override: prevent additive bottom padding
   (from .content + .uploader) from creating excessive empty space on wide
   screens. Keep the action row comfortably above the bottom nav. */
@media (min-width: 900px) {
  .content .uploader.has-preview { padding-bottom: calc(36px + var(--safe-bottom)) !important; }
  .content .uploader .form-row { bottom: calc(12px + var(--safe-bottom)) !important; }
}

/* When the upload UI includes a preview, reduce the outer content padding so
   the uploader controls don't create a large empty area. Use :has() to target
   the page container when it contains the uploader. Modern Chromium browsers
   support :has(); if the browser doesn't support it the fixed action bar
   fallback will still keep controls accessible. */
@media (min-width: 900px) {
  .content:has(.uploader.has-preview) {
    padding-bottom: calc(24px + var(--safe-bottom)) !important;
  }
}

/* Fallback for browsers without :has() — toggled by the uploader JS */
@media (min-width: 900px) {
  body.uploader-has-preview .content { padding-bottom: calc(24px + var(--safe-bottom)) !important; }
}

.image-editor { z-index: 80; position: relative; }
.preview:not(.hidden) { display: block; }

/* Image action buttons (edit/change) - icon-only with animations */
.image-actions { position: absolute; right: 12px; bottom: 12px; display: flex; gap: 8px; z-index: 10; }
.image-action-btn { position: relative; display: inline-flex; align-items: center; justify-content: center; width: 44px; height: 44px; border-radius: 50%; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px) saturate(140%); border: 1px solid rgba(255, 255, 255, 0.15); color: #fff; cursor: pointer; transition: all 240ms cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 14px rgba(0, 0, 0, 0.25); }
.image-action-btn svg { width: 20px; height: 20px; transition: transform 260ms cubic-bezier(0.34, 1.56, 0.64, 1), opacity 180ms ease; }
.image-action-btn:hover { transform: scale(1.08) translateY(-2px); background: rgba(0, 0, 0, 0.85); border-color: rgba(255, 255, 255, 0.25); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35); }
.image-action-btn:hover svg { transform: scale(1.1) rotate(-3deg); }
.image-action-btn:active { transform: scale(0.96); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); }
.image-action-btn:focus-visible { outline: 2px solid rgba(255, 255, 255, 0.6); outline-offset: 2px; }



/* Specific button animations */
.image-action-btn.edit-btn:hover svg { transform: scale(1.12) rotate(6deg); }
.image-action-btn.change-btn:hover svg { transform: scale(1.12) translateY(-2px); }

/* Light theme adjustments */
:root[data-theme="light"] .image-action-btn { background: rgba(255, 255, 255, 0.92); color: var(--text); border-color: rgba(0, 0, 0, 0.08); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12); }
:root[data-theme="light"] .image-action-btn:hover { background: rgba(255, 255, 255, 0.98); border-color: rgba(0, 0, 0, 0.12); box-shadow: 0 6px 18px rgba(0, 0, 0, 0.16); }

/* Make the processing overlay plain white in light theme and remove blur */
:root[data-theme="light"] .drop-loader {
  background: #fff !important;
  color: var(--text) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
:root[data-theme="light"] .drop-loader::before {
  background: #fff !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  opacity: 1 !important; /* ensure the pseudo-overlay is visible as solid white */
}

/* Mobile: slightly smaller icons */
@media (max-width: 640px) {
  .image-action-btn { width: 40px; height: 40px; }
  .image-action-btn svg { width: 18px; height: 18px; }
  .image-actions { right: 10px; bottom: 10px; gap: 6px; }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .image-action-btn, .image-action-btn svg { transition: none !important; }
  .image-action-btn:hover { transform: none; }
  .image-action-btn:hover svg { transform: scale(1); }
}

.form-row { display: flex; gap: 12px; align-items: center; justify-content: space-between; margin-top: 6px; }
.form-row .vis-label { display: flex; flex-direction: column; align-items: flex-start; gap: 6px; }
.visibility-select { padding: 8px 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text); }

/* Segmented visibility buttons (Public / Private) */
.form-row .vis-label .btn {
  border-radius: 999px;
  padding: 8px 14px;
  background: var(--bg-elev);
  border: 1px solid var(--border);
  color: var(--muted);
  box-shadow: none;
  transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), color var(--transition-fast);
}
.form-row .vis-label .btn:hover {
  transform: translateY(-1px);
}
.form-row .vis-label .btn.active,
.form-row .vis-label .btn[aria-pressed="true"] {
  background: var(--primary);
  border-color: transparent;
  color: white;
  box-shadow: 0 12px 30px color-mix(in srgb, var(--primary), transparent 70%);
  transform: translateY(-6px);
}
.form-row .vis-label .btn:focus {
  outline: 3px solid color-mix(in srgb, var(--primary), transparent 64%);
  outline-offset: 4px;
}

/* Visibility icon and subtle animation */
.vis-icon { display: inline-grid; place-items: center; width: 18px; height: 18px; margin-right: 8px; position: relative; }
.vis-icon svg { position: absolute; top: 0; left: 0; width: 18px; height: 18px; color: currentColor; transition: opacity 180ms var(--transition-fast), transform 200ms var(--transition-fast); }
/* default: show open eye for Public, hide closed eye */
.form-row .vis-label button[data-type="public"] .vis-icon .eye-open { opacity: 1; transform: scale(1); }
.form-row .vis-label button[data-type="public"] .vis-icon .eye-closed { opacity: 0; transform: scale(0.92) rotate(-6deg); }
/* default: show closed eye for Private (muted) */
.form-row .vis-label button[data-type="private"] .vis-icon .eye-open { opacity: 0.42; transform: scale(0.98); }
.form-row .vis-label button[data-type="private"] .vis-icon .eye-closed { opacity: 0.9; transform: scale(1); }
/* when active, swap to the correct icon and apply subtle motion */
.form-row .vis-label button[data-type="public"][aria-pressed="true"] .vis-icon .eye-open {
  opacity: 1; transform: scale(1) rotate(0deg);
}
.form-row .vis-label button[data-type="public"][aria-pressed="true"] .vis-icon .eye-closed {
  opacity: 0; transform: scale(0.92) rotate(-6deg);
}

.form-row .vis-label button[data-type="private"][aria-pressed="true"] .vis-icon .eye-open {
  opacity: 0; transform: scale(0.92) rotate(6deg);
}
.form-row .vis-label button[data-type="private"][aria-pressed="true"] .vis-icon .eye-closed {
  opacity: 1; transform: scale(1) rotate(0deg);
}

/* active pill glow and lift */
.form-row .vis-label .btn.active {
  transform: translateY(-6px);
  color: #fff;
}
.form-row .vis-label .btn.active .vis-icon svg { color: #fff; }
.form-row .vis-label .btn.active::after {
  content: "";
  position: absolute;
  inset: -8px; /* expand behind the pill */
  border-radius: 999px;
  z-index: -1;
  background: radial-gradient(closest-side, color-mix(in srgb, var(--primary), transparent 40%), transparent 60%);
  filter: blur(10px);
  opacity: 0.95;
  transition: opacity 220ms var(--transition-fast), transform 220ms var(--transition-fast);
}

/* Public active pill: strong primary color */
.form-row .vis-label button[data-type="public"].active {
  background: var(--primary);
  border-color: transparent;
}

/* In light theme use dark text for the active visibility pill (pastel/weak primary)
   but keep white text in dark theme for contrast. These selectors are placed
   after the base rules to take precedence. */
:root[data-theme="light"] .form-row .vis-label .btn.active,
:root[data-theme="light"] .form-row .vis-label button[data-type="public"].active {
  color: var(--text) !important;
}
:root[data-theme="light"] .form-row .vis-label .btn.active .vis-icon svg,
:root[data-theme="light"] .form-row .vis-label button[data-type="public"].active .vis-icon svg {
  color: var(--text) !important;
}

/* Also ensure the vis-toggle CSS variable used for color is dark in light theme
   (vis-toggle uses --vis-color and applies it with !important). */
:root[data-theme="light"] .vis-toggle.public,
:root[data-theme="light"] .btn.vis-toggle.public,
:root[data-theme="light"] .form-row .vis-label button[data-type="public"].active.vis-toggle {
  --vis-color: var(--text) !important;
}

/* Private active pill: muted but still with visible accent */
.form-row .vis-label button[data-type="private"].active {
  background: linear-gradient(180deg, color-mix(in srgb, var(--bg-elev), rgba(255,255,255,0.02)), color-mix(in srgb, var(--primary), transparent 92%));
  border-color: transparent;
}

/* In light theme make Private active pill use dark text (match Public) */
:root[data-theme="light"] .form-row .vis-label button[data-type="private"].active {
  /* mix primary with the light background to produce a subtle blue pill */
  background: color-mix(in srgb, var(--primary), var(--bg) 62%);
  border-color: transparent;
  box-shadow: 0 12px 30px rgba(37,99,235,0.10);
  color: var(--text) !important;
}

/* Also ensure the vis-toggle CSS variable for private is dark in light theme */
:root[data-theme="light"] .vis-toggle.private,
:root[data-theme="light"] .btn.vis-toggle.private,
:root[data-theme="light"] .form-row .vis-label button[data-type="private"].active.vis-toggle {
  --vis-color: var(--text) !important;
}

/* Single toggle style for visibility (eye icon) */
/* ensure vis-toggle overrides base .btn styles when both are present */
.btn.vis-toggle,
.vis-toggle {
  /* use CSS vars so transitions are smooth between states */
  --vis-bg: var(--bg-elev);
  --vis-color: var(--text);
  --vis-glow: transparent;

  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px; /* unified pill spacing */
  min-height: var(--action-pill-height,42px);
  border-radius: 999px;
  background: var(--vis-bg) !important;
  border: 1px solid var(--border) !important;
  color: var(--vis-color) !important;
  position: relative;
  transition: background 360ms cubic-bezier(.2,.8,.2,1), color 260ms var(--transition-fast), box-shadow 360ms cubic-bezier(.2,.8,.2,1), transform 220ms var(--transition-fast);
}
.vis-toggle::after {
  /* remove the large outer halo completely to avoid double-outline */
  display: none !important;
}
.vis-toggle .vis-icon { position: relative; width: 18px; height: 18px; display: inline-grid; place-items: center; }
.vis-toggle .vis-icon svg { position: absolute; top: 0; left: 0; width: 18px; height: 18px; transition: transform 320ms cubic-bezier(.2,.8,.2,1), opacity 260ms var(--transition-fast); }

.vis-toggle.public {
  /* Public: blue-ish pill (active visible state) */
  --vis-bg: color-mix(in srgb, var(--primary), var(--bg) 64%);
  --vis-color: #fff;
  --vis-glow: color-mix(in srgb, var(--primary), transparent 70%);
  transform: none;
  border-color: transparent;
  box-shadow: none; /* remove strong outer shadow that looks like an outline */
}

/* Ensure the toggle does not show an outline or shadow when focused */
.vis-toggle:focus,
.vis-toggle:focus-visible,
.btn.vis-toggle:focus,
.btn.vis-toggle:focus-visible {
  outline: none !important;
  box-shadow: none !important;
}
.vis-toggle.public .eye-open { opacity: 1; transform: translateY(0) scale(1); }
.vis-toggle.public .eye-closed { opacity: 0; transform: translateY(-6px) scale(0.92) rotate(-6deg); }

.vis-toggle.private {
  /* Private: dark-ish pill (hidden/private state) */
  --vis-bg: color-mix(in srgb, rgba(0,0,0,0.6), var(--bg) 36%);
  --vis-color: #fff;
  --vis-glow: transparent;
  transform: translateY(-1px);
  border-color: transparent;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
}
.vis-toggle.private .eye-open { opacity: 0; transform: translateY(6px) scale(0.92); }
.vis-toggle.private .eye-closed { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }

/* focus state for accessibility */
.vis-toggle:focus { outline: 3px solid color-mix(in srgb, var(--primary), transparent 64%); outline-offset: 4px; }

/* subtle press feedback */
.vis-toggle:active { transform: translateY(-1px) scale(0.997); }

@media (prefers-reduced-motion: reduce) {
  .vis-toggle, .vis-toggle .vis-icon svg { transition: none !important; }
  .vis-toggle::after { transition: none !important; }
}



/* smaller label under buttons to emphasize primary action on mobile */
@media (max-width: 640px) {
  .form-row .vis-label .btn { padding: 10px 12px; }
}

.btn-group { display: flex; gap: 8px; align-items: center; }
.btn.primary { padding: 10px 14px; border-radius: 12px; font-weight: 700; }
.btn.ghost.replace { padding: 10px 12px; }
/* Cancel button unified logic
   - Base: neutral subtle pill (light/dark adapt via bg vars)
   - Confirm (double-tap): solid danger emphasis
   Keep transitions minimal & accessible. */
.btn.cancel-btn {
  position: relative;
  padding: 10px 18px;
  border-radius: 999px;
  font-weight: 600;
  font-size: 14px;
  line-height: 1;
  min-height: var(--action-pill-height,42px);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  letter-spacing: .25px;
  background: color-mix(in srgb, var(--bg-elev), var(--danger) 4%);
  border: 1px solid color-mix(in srgb, var(--danger), transparent 86%);
  color: color-mix(in srgb, var(--danger), var(--text) 65%);
  transition: background var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast);
}
.btn.cancel-btn:hover { background: color-mix(in srgb, var(--bg-elev), var(--danger) 6%); transform: translateY(-2px); }
.btn.cancel-btn:active { transform: translateY(0); }
.btn.cancel-btn.confirm {
  background: linear-gradient(135deg, color-mix(in srgb, var(--danger), transparent 6%), color-mix(in srgb, var(--danger), transparent 2%));
  color: #fff;
  border-color: color-mix(in srgb, var(--danger), transparent 12%);
  box-shadow: 0 6px 22px color-mix(in srgb, var(--danger), transparent 72%), 0 0 0 1px color-mix(in srgb, var(--danger), transparent 40%) inset;
  text-shadow: 0 1px 2px rgba(0,0,0,0.35);
}
.btn.cancel-btn.confirm:hover { background: linear-gradient(135deg, color-mix(in srgb, var(--danger), transparent 4%), color-mix(in srgb, var(--danger), transparent 0%)); }
.btn.cancel-btn:focus-visible { outline: none; box-shadow: 0 0 0 3px color-mix(in srgb, var(--danger), transparent 70%), 0 4px 16px rgba(0,0,0,0.18); }
.btn.cancel-btn.confirm:focus-visible { box-shadow: 0 0 0 3px color-mix(in srgb, var(--danger), transparent 55%), 0 6px 20px rgba(0,0,0,0.30); }
.btn.cancel-btn:disabled { opacity: .55; cursor: not-allowed; transform: none; }
.btn.cancel-btn .cancel-inner { position: relative; z-index: 1; }

/* Dark theme slight desaturation for base state for balance */
:root[data-theme="dark"] .btn.cancel-btn:not(.confirm) {
  background: color-mix(in srgb, var(--bg-elev), var(--danger) 6%);
  border-color: color-mix(in srgb, var(--danger), transparent 78%);
  color: color-mix(in srgb, var(--danger), var(--text) 72%);
}
:root[data-theme="dark"] .btn.cancel-btn:not(.confirm):hover { background: color-mix(in srgb, var(--bg-elev), var(--danger) 8%); }

/* Mobile full-width stacking coherence */
@media (max-width:640px){
  .btn-group .btn.cancel-btn { width:100%; }
}

/* Uploader-specific mobile improvements: avoid overlap with bottom tabbar, tighten dropzone and thumbnails */
@media (max-width: 640px) {
  /* give uploader extra bottom padding only when images present so initial empty state doesn't force scroll */
  .uploader.has-preview { padding-bottom: calc(92px + var(--safe-bottom)) !important; }


/* Mobile refinement: make stacked action pills (visibility / publish / cancel) align and breathe */
@media (max-width: 640px) {
  /* Slightly reduce pill height on small screens for a tighter stack */
  :root { --action-pill-height: 38px; }

  .uploader .form-row { gap: 10px; align-items: center; }
  .uploader .form-row .btn-group { width: 100%; gap: 10px; align-items: center; }

  /* Give all three pills a consistent width, centered. Clamp to avoid overly wide on large phones */
  .uploader .form-row .vis-toggle,
  .uploader .form-row .publish-button,
  .uploader .form-row .btn.cancel-btn { 
    width: 100%;
    max-width: 240px; 
    margin: 0 auto; 
  }

  /* Ensure internal padding adapts with smaller height */
  .uploader .form-row .vis-toggle { padding: 8px 16px; }
  .uploader .form-row .publish-button { padding: 8px 18px; }
  .uploader .form-row .btn.cancel-btn { padding: 8px 18px; }
}


  /* reduce preview max height to keep controls visible and avoid large images pushing buttons off-screen */
  .preview-inner { max-height: 56vh; }
  .preview img { max-height: 52vh; }

  /* make thumbnail strip smaller and easier to tap */
  .uploader .thumbs img { width: 56px; height: 56px; }

  /* stack publish/replace buttons and make them full-width for easier tapping */
  .btn-group { display: flex; flex-direction: column; gap: 8px; }
  .btn-group .btn { width: 100%; display: inline-flex; justify-content: center; }

  /* center visibility controls under the caption input on small screens */
  .form-row .vis-label { align-items: center; width: 100%; }
  .form-row .vis-label [role="radiogroup"] { display: flex !important; justify-content: center; width: 100%; gap: 8px; }

  /* inputs stretch to full width and have comfortable spacing */
  .input { font-size: 15px; padding: 12px; }

  /* reduce carousel control sizes on small screens */
  .carousel-arrow { width: 34px; height: 34px; }
}

/* small helper: visually hidden but available to screen readers */
.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }